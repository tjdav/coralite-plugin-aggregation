<template id="coralite-posts">
  {{ posts }}
</template>

<script type="module">
  import { defineComponent } from 'coralite'
  import { aggregation } from 'coralite/plugins'

  export default defineComponent({
    tokens: {
      posts (values) {
        const limit = values.limit ? parseInt(values.limit) : 10
        const options = {
          path: values.path.split(','),
          template: 'coralite-post',
          limit
        }

        if (values.filter) {
          options.filter = function (meta) {
            return (meta.name === 'country' && (meta.content === 'au' || meta.content === 'mx'))
          }
        }

        if (values.pagination) {
          options.pagination = {
            template: 'coralite-pagination',
            maxVisible: values.paginationMaxVisible,
            segment: values.paginationSegment
          }
        }

        return aggregation(options)
      }
    }
  })
</script>